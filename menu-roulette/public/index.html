<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì ì‹¬ë©”ë‰´ ì¶”ì²¨ê¸° ğŸ½ï¸</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Apple SD Gothic Neo', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 24px;
            padding: 40px;
            max-width: 700px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-height: 90vh;
            overflow-y: auto;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 2em;
        }

        .location {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 0.9em;
        }

        .search-section {
            background: #e3f2fd;
            border: 2px solid #2196f3;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
        }

        .search-button {
            width: 100%;
            padding: 14px;
            background: #2196f3;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }

        .search-button:hover {
            background: #1976d2;
            transform: translateY(-2px);
        }

        .search-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .result-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-radius: 16px;
            padding: 40px;
            margin-bottom: 30px;
            text-align: center;
            min-height: 280px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease;
        }

        .result-card.spinning {
            animation: spin 0.5s ease-in-out infinite;
        }

        @keyframes spin {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .restaurant-name {
            font-size: 2em;
            font-weight: bold;
            color: white;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .restaurant-type {
            font-size: 1.1em;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 15px;
        }

        .restaurant-address {
            font-size: 0.95em;
            color: rgba(255, 255, 255, 0.85);
            margin-top: 10px;
            line-height: 1.4;
        }

        .restaurant-distance {
            font-size: 1em;
            color: rgba(255, 255, 255, 0.9);
            margin-top: 10px;
            font-weight: 600;
        }

        .placeholder-text {
            font-size: 1.5em;
            color: rgba(255, 255, 255, 0.9);
            text-align: center;
        }

        .draw-button {
            width: 100%;
            padding: 18px;
            font-size: 1.2em;
            font-weight: bold;
            color: white;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .draw-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .draw-button:active {
            transform: translateY(0);
        }

        .draw-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .restaurant-list {
            margin-top: 20px;
        }

        .restaurant-list h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .restaurant-grid {
            display: grid;
            gap: 10px;
            margin-bottom: 20px;
        }

        .restaurant-item {
            background: #f8f9fa;
            padding: 14px 18px;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .restaurant-item:hover {
            background: #e9ecef;
            transform: translateX(4px);
        }

        .restaurant-item-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 6px;
            font-size: 1em;
        }

        .restaurant-item-type {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 4px;
        }

        .restaurant-item-distance {
            font-size: 0.8em;
            color: #999;
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 20px;
        }

        .page-button {
            padding: 8px 14px;
            border: 2px solid #667eea;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
            color: #667eea;
            min-width: 40px;
        }

        .page-button:hover:not(:disabled) {
            background: #f0f0ff;
        }

        .page-button.active {
            background: #667eea;
            color: white;
        }

        .page-button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .emoji {
            font-size: 3em;
            margin-bottom: 20px;
        }

        .stats {
            text-align: center;
            margin-bottom: 20px;
            color: #666;
            font-size: 0.9em;
        }

        .error-message {
            background: #f8d7da;
            border: 2px solid #f5c6cb;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 480px) {
            .container {
                padding: 24px;
            }

            h1 {
                font-size: 1.5em;
            }

            .restaurant-name {
                font-size: 1.5em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ½ï¸ ì ì‹¬ë©”ë‰´ ì¶”ì²¨ê¸°</h1>
        <div class="location">ğŸ“ ì•„ì¼ë ‰ìŠ¤ (ì–‘í™”ë¡œ 147) ê·¼ì²˜ 300m</div>
        
        <div class="search-section">
            <p style="margin-bottom: 15px; color: #1976d2; font-weight: 600;">
                ğŸ” ë„¤ì´ë²„ APIë¡œ ì‹¤ì‹œê°„ ê²€ìƒ‰
            </p>
            <button class="search-button" onclick="searchRestaurants()">
                ì£¼ë³€ ìŒì‹ì  ê²€ìƒ‰í•˜ê¸°
            </button>
        </div>

        <div id="errorMessage" class="error-message hidden"></div>
        
        <div class="stats" id="stats">ê²€ìƒ‰ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”</div>

        <div class="result-card" id="resultCard">
            <div class="emoji">ğŸ°</div>
            <div class="placeholder-text">ì£¼ë³€ ìŒì‹ì ì„ ë¨¼ì € ê²€ìƒ‰í•´ì£¼ì„¸ìš”!</div>
        </div>

        <button class="draw-button" id="drawButton" onclick="drawRestaurant()" disabled>
            ğŸ² ëœë¤ ì¶”ì²¨í•˜ê¸°
        </button>

        <div class="restaurant-list hidden" id="restaurantListSection">
            <h3 id="listTitle">ğŸ“‹ ê·¼ì²˜ ìŒì‹ì  ëª©ë¡</h3>
            <div class="restaurant-grid" id="restaurantList"></div>
            
            <div class="pagination" id="pagination"></div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let allRestaurants = [];
        let currentPage = 1;
        const itemsPerPage = 5;
        let isDrawing = false;

        // API ì„œë²„ ì£¼ì†Œ (ë¡œì»¬ ì„œë²„)
        const API_URL = '/api/search';

        // ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
        function showError(message) {
            const errorEl = document.getElementById('errorMessage');
            errorEl.textContent = message;
            errorEl.classList.remove('hidden');
        }

        // ì—ëŸ¬ ë©”ì‹œì§€ ìˆ¨ê¸°ê¸°
        function hideError() {
            document.getElementById('errorMessage').classList.add('hidden');
        }

        // ë„¤ì´ë²„ APIë¡œ ìŒì‹ì  ê²€ìƒ‰
        async function searchRestaurants() {
            hideError();
            
            const searchButton = document.querySelector('.search-button');
            searchButton.disabled = true;
            searchButton.textContent = 'ê²€ìƒ‰ ì¤‘... â³';
            
            try {
                const response = await fetch(API_URL);
                
                if (!response.ok) {
                    throw new Error('ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜');
                }

                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.error || 'ê²€ìƒ‰ ì‹¤íŒ¨');
                }

                allRestaurants = data.restaurants;

                if (allRestaurants.length === 0) {
                    showError('300m ì´ë‚´ì— ìŒì‹ì ì´ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }

                // UI ì—…ë°ì´íŠ¸
                document.getElementById('stats').textContent = 
                    `ì•„ì¼ë ‰ìŠ¤ì—ì„œ ë„ë³´ 3ë¶„ ê±°ë¦¬ Â· ì´ ${allRestaurants.length}ê°œ ìŒì‹ì `;
                
                document.getElementById('drawButton').disabled = false;
                document.getElementById('restaurantListSection').classList.remove('hidden');
                
                currentPage = 1;
                displayRestaurantList();
                
                searchButton.textContent = 'âœ… ê²€ìƒ‰ ì™„ë£Œ! (ë‹¤ì‹œ ê²€ìƒ‰í•˜ê¸°)';
                
            } catch (error) {
                showError('ê²€ìƒ‰ ì‹¤íŒ¨: ' + error.message + '\n\nì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”!');
                searchButton.textContent = 'ì£¼ë³€ ìŒì‹ì  ê²€ìƒ‰í•˜ê¸°';
            } finally {
                searchButton.disabled = false;
            }
        }

        // í˜ì´ì§€ë„¤ì´ì…˜ëœ ìŒì‹ì  ëª©ë¡ í‘œì‹œ
        function displayRestaurantList() {
            const listContainer = document.getElementById('restaurantList');
            const paginationContainer = document.getElementById('pagination');
            
            // í˜„ì¬ í˜ì´ì§€ ë°ì´í„°
            const startIdx = (currentPage - 1) * itemsPerPage;
            const endIdx = startIdx + itemsPerPage;
            const pageData = allRestaurants.slice(startIdx, endIdx);
            
            // ìŒì‹ì  ëª©ë¡ í‘œì‹œ
            listContainer.innerHTML = pageData.map(r => `
                <div class="restaurant-item">
                    <div class="restaurant-item-name">${r.name}</div>
                    <div class="restaurant-item-type">${r.category}</div>
                    <div class="restaurant-item-distance">ğŸš¶ ${r.distance}m Â· ${r.address}</div>
                </div>
            `).join('');
            
            // í˜ì´ì§€ë„¤ì´ì…˜ ë²„íŠ¼
            const totalPages = Math.ceil(allRestaurants.length / itemsPerPage);
            paginationContainer.innerHTML = '';
            
            // ì´ì „ ë²„íŠ¼
            const prevBtn = document.createElement('button');
            prevBtn.className = 'page-button';
            prevBtn.textContent = 'â—€';
            prevBtn.disabled = currentPage === 1;
            prevBtn.onclick = () => {
                if (currentPage > 1) {
                    currentPage--;
                    displayRestaurantList();
                }
            };
            paginationContainer.appendChild(prevBtn);
            
            // í˜ì´ì§€ ë²ˆí˜¸
            for (let i = 1; i <= totalPages; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = 'page-button' + (i === currentPage ? ' active' : '');
                pageBtn.textContent = i;
                pageBtn.onclick = () => {
                    currentPage = i;
                    displayRestaurantList();
                };
                paginationContainer.appendChild(pageBtn);
            }
            
            // ë‹¤ìŒ ë²„íŠ¼
            const nextBtn = document.createElement('button');
            nextBtn.className = 'page-button';
            nextBtn.textContent = 'â–¶';
            nextBtn.disabled = currentPage === totalPages;
            nextBtn.onclick = () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    displayRestaurantList();
                }
            };
            paginationContainer.appendChild(nextBtn);
        }

        // ëœë¤ ì¶”ì²¨
        function drawRestaurant() {
            if (isDrawing || allRestaurants.length === 0) return;
            
            isDrawing = true;
            const button = document.getElementById('drawButton');
            const card = document.getElementById('resultCard');
            
            button.disabled = true;
            button.textContent = 'ì¶”ì²¨ ì¤‘...';
            card.classList.add('spinning');

            let counter = 0;
            const maxCount = 20;
            const interval = setInterval(() => {
                const randomRestaurant = allRestaurants[Math.floor(Math.random() * allRestaurants.length)];
                displayResult(randomRestaurant, true);
                counter++;

                if (counter >= maxCount) {
                    clearInterval(interval);
                    
                    setTimeout(() => {
                        const finalRestaurant = allRestaurants[Math.floor(Math.random() * allRestaurants.length)];
                        card.classList.remove('spinning');
                        displayResult(finalRestaurant, false);
                        
                        button.disabled = false;
                        button.textContent = 'ğŸ² ë‹¤ì‹œ ì¶”ì²¨í•˜ê¸°';
                        isDrawing = false;
                    }, 300);
                }
            }, 100);
        }

        // ê²°ê³¼ í‘œì‹œ
        function displayResult(restaurant, isSpinning) {
            const card = document.getElementById('resultCard');
            const emojis = ['ğŸ–', 'ğŸœ', 'ğŸ•', 'ğŸ¥˜', 'ğŸ²', 'ğŸ¥©', 'ğŸ', 'ğŸ±', 'ğŸ”', 'ğŸ—', 'ğŸ¥Ÿ', 'ğŸ›'];
            const randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];
            
            card.innerHTML = `
                <div class="emoji">${isSpinning ? 'ğŸ°' : randomEmoji}</div>
                <div class="restaurant-name">${restaurant.name}</div>
                <div class="restaurant-type">${restaurant.category}</div>
                <div class="restaurant-distance">ğŸš¶ ${restaurant.distance}m (ë„ë³´ ${Math.ceil(restaurant.distance / 80)}ë¶„)</div>
                <div class="restaurant-address">ğŸ“ ${restaurant.address}</div>
            `;
        }
    </script>
</body>
</html>
